<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="../../../js/easyui/themes/default/easyui.css"></link>
		<link rel="stylesheet" type="text/css" href="../../../js/easyui/themes/icon.css"></link>
		<link rel="stylesheet" type="text/css" href="../../../js/easyui/demo/demo.css"></link>
		
		<script src="http://www.jq22.com/jquery/1.4.4/jquery.min.js"></script>
		<!--<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.1.min.js"></script>-->
    	<script type="text/javascript" src="../../../js/easyui/jquery.easyui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/style5.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery.confirm.css" />
		
		<title></title>
		<style>
			.datagrid-row-selected{background-color:#e0ecff;}
			.page-bottom a:link,
			.page-bottom a:visited {
				color: rgba(255, 255, 255, .7);
			}
			
			h6 {
				margin: 10px;
			}
			
			body {
				margin: 0px;
			}
			
			.logo {
				padding: 0px;
			}
			
			.logo li {
				float: left;
			}
			
			.logo img {
				width: 80px;
				height: 80px;
				margin-left: 100px;
				margin-top: 55px;
			}
			
			.logoContain {
				width: 447px;
				height: 200px;
				float: left;
			}
			
			#little {
				height: 177px;
				background-color: black;
				position: absolute;
				width: 303px;
			}
			
			#little:hover {
				background-color: #419641;
			}
			.datagrid-view2{height: 360px;}
		</style>
		<script type="text/javascript">
			function returnHome(){
				alert($("#home").val());
				$("#home").click();
			};
			
			$(function() {
				//删除
				$("#tb_remove").click(function() {
					var row = $('#depart_list').datagrid('getChecked');
					if(row.length > 0) {
						$.confirm({
							'title'		: 'Delete Confirmation',
							'message'	: 'You are sure to delete this item? <br />',
							'buttons'	: {
								'Yes'	: {
									'class'	: 'blue',
									'action': function(){
										$.ajax({
											  url:"http://localhost:9090/ihs/departs/"+row[0].id,
											  type:'DELETE',
											  contentType:"application/json; charset=utf-8",
											  dataType:"json",
											  success: function(data){
											    if(data.result == true) {
															$('#depart_list').datagrid('load');
															$('#depart_list').datagrid('unselectAll');
														}
											  }
											})
											
									}
								},
								'No'	: {
									'class'	: 'gray',
									'action': function(){}	
								}
							}
						});
						
					} else {
						$.confirm({
							'title'		: 'Delete Confirmation',
							'message'	: 'please choose the item to delete <br />',
							'buttons'	: {
								'ok'	: {
									'class'	: 'blue',
									'action': function(){
										
									}
								}
							}
						});
					}
				});

				/* 	数据列表分页 */
				$('#depart_list').datagrid({
					method: 'get',
					singleSelect: true,
					fitColumns:true,
					pageSize: 10,
					pageList: [3, 5, 10, 15],
					url: 'http://localhost:9090/ihs/departs',
					columns: [
						[{
							field: '选择',
							checkbox: true
						}, {
							field: 'id',
							title: '编号',
							width: 150							
						}, {
							field: 'name',
							title: '科室名称',
							width: 100,
							editor: 'text'
						}, {
							field: 'summary',
							title: '简介',
							width: 350,
							align: 'left',
							editor: 'text'
						}, {
							field: 'create_by',
							title: '创建人',
							width: 100,
							align: 'left'
						}, {
							field: 'create_date',
							title: '创建时间',
							width: 200,
							align: 'left'
						}, ]
					],
					pagination: true,
					loadMsg: '数据装载中......',
					toolbar: '#depart_tb',
				});

				$('#depart_list').datagrid('getPager').pagination({
					beforePageText: '第',
					afterPageText: '页    共 {pages} 页',
					displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
				});

				$("#searchBtn").click(function() {

					$("#depart_list").datagrid("load", {
						"name": $("#name").val(),
						"summary": $("#summary").val()
					});

				});

			});
			//编辑前
			function beforeUpdate(){
				var row = $('#depart_list').datagrid('getSelected');
				if(row) {
					var index = $('#depart_list').datagrid('getRowIndex', row);
					$('#depart_list').datagrid('selectRow', index);
					$('#depart_list').datagrid('beginEdit', index);
					
				}else{
					
					$.confirm({
							'title'		: 'Delete Confirmation',
							'message'	: 'please choose the item to update <br />',
							'buttons'	: {
								'ok'	: {
									'class'	: 'blue',
									'action': function(){
										
									}
								}
							}
						});
					
				}
			}
			//保存编辑
			function update(){
				var row = $('#depart_list').datagrid('getSelected');
				if(row){
					var index = $('#depart_list').datagrid('getRowIndex', row);
					$("#depart_list").datagrid('endEdit', index); 
					$.ajax({
							  url:"http://localhost:9090/ihs/departs/"+row.id,
							  type:'PUT',
							  data:JSON.stringify({'name':row.name,'summary':row.summary}),
							  contentType:"application/json; charset=utf-8",
							  dataType:"json",
							  success: function(data){
							    if(data.result == true) {
											$('#depart_list').datagrid('load');
											$('#depart_list').datagrid('unselectAll');
										}
							  }
							})
						
				}
			}
			
			
			//新增一行		
			function insert() {
				var row = $('#depart_list').datagrid('getSelected');
				if(row) {
					var index = $('#depart_list').datagrid('getRowIndex', row);
				} else {
					index = 0;
				}
				$('#depart_list').datagrid('insertRow', {
					index: index,
					row: {
						id: ''
					}
				});
				
				$('#depart_list').datagrid('selectRow', index);
				$('#depart_list').datagrid('beginEdit', index);
			}
			//保存
			function preserve(){
				var row = $('#depart_list').datagrid('getSelected');
				if(row){
					var index = $('#depart_list').datagrid('getRowIndex', row);
					$("#depart_list").datagrid('endEdit', index); 
					
					$.ajax({
							  url:"http://localhost:9090/ihs/departs",
							  type:"POST",
							  data:JSON.stringify({'name':row.name,'summary':row.summary}),
							  contentType:"application/json; charset=utf-8",
							  dataType:"json",
							  success: function(data){
							    if(data.result == true) {
											$('#depart_list').datagrid('load');
											$('#depart_list').datagrid('unselectAll');
										}
							  }
							})
						
				}
			}
		</script>
	</head>

	<body style="background-color: #F5F5F5;">
		<!--end导航条end-->
		<div style="width: 98%;height: 580px;position:absolute;top: 180px;margin-left:20px ;">
			<div style="width: 73%;height: 578px;border: 1px solid #EBEBEB;float: left;background-color: white;">
				<form action="#" id="searchForm" style="margin-bottom: 20px;">
					<fieldset>
						<legend>查询条件</legend>

						<table border="0" cellpadding="5" cellspacing="0">
							<tr>

								<td>科室名称:</td>
								<td>
									<input type="text" id="name" name="name" data-options="required:true" style="width:150px;" />
								</td>
								<td>简介:</td>
								<td>
									<input type="text" id="summary" name="summary" data-options="required:true" style="width:150px;" />
								</td>
								<td>
									<a id="searchBtn" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">查询</a>
								</td>
							</tr>
						</table>
					</fieldset>
				</form>

				<table id="depart_list"></table>
				<!-- 工具栏 -->
				<div id="depart_tb">
					<a class="easyui-linkbutton" id="tb_edit" data-options="iconCls:'icon-edit',plain:true" style="float:left;" onclick="beforeUpdate()" title="编辑"></a>
					<div class="datagrid-btn-separator"></div>
					<a class="easyui-linkbutton" id="tb_ad" data-options="iconCls:'icon-add',plain:true" style="float:left;" onclick="insert()" title="增加"></a>
					<div class="datagrid-btn-separator"></div>
					<a class="easyui-linkbutton" id="tb_remove" data-options="iconCls:'icon-remove',plain:true" style="float:left;" title="删除"></a>
					<div class="datagrid-btn-separator"></div>
				</div>
				
				
				<!--按钮-->
				<div class="container">
					<div class="content">
						<div class="button-wrapper">
							<a href="javascript:;" class="a-btn" onclick="update()">
								<span class="a-btn-text">修 改</span>
							</a>
						</div>
		            </div>
		            <div class="content">
						<div class="button-wrapper">
							<a href="javascript:;" class="a-btn" onclick="preserve()">
								<span class="a-btn-text">保  存</span>
							</a>
						</div>
		            </div>
		        </div>
				<!--按钮 end-->
				
				
			</div>
			<div style="width: 23%;height: 578px;border: 1px solid #EBEBEB;float: left;margin-left: 30px;background-color: white;">
				<div style="height: 46px;background-color: #FF6600;margin-bottom: 4px;"></div>
				<img src="../../img/right.jpg" height="350px" width="301px" />
				<div id="little">
					<div style="color: white;font-size: 22px;margin: 20px;position: absolute;top: 48px;">Dedication to the heart</div>
				</div>
			</div>
		</div>

		<div class="page-bottom" style="width: 100%;height: 250px;background-color:black;position:absolute;top: 850px;">
			<div class="logoContain">
				<ul class="logo">
					<li><img src="../../img/hospital2.png" /></li>
					<li><img src="../../img/hospital3.png" /></li>
				</ul>

			</div>
			<div style="float: left;margin-top: 70px;">
				<h6 style="color: white;text-align: center;color: #60606d;">All start from the heart.</h6>
				<h6 style="color: white;text-align: center;color: #60606d;">Interconnection Hospital System 1.0 author:pengfei.zhou</h6>
				<h6 style="color: white;text-align: center;color: #60606d;"> IHS&nbsp;遵循 <a href="http://scripts.sil.org/OFL">SIL OFL 1.1 协议</a>&middot;代码遵循 <a href="http://opensource.org/licenses/mit-license.html">MIT协议</a>&middot;文档遵循 <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0 协议</a></h6>
				<h6 style="color: white;text-align: center;color: #60606d;"><a href="https://github.com/FortAwesome/Font-Awesome">GitHub项目</a> </h6>

			</div>

			<div class="logoContain">
				<ul class="logo">
					<li><img src="../../img/hospital4.png" /></li>
					<li><img src="../../img/hospital5.png" /></li>
				</ul>
			</div>
		</div>
	</body>
<script type="text/javascript" src="js/jquery.confirm.js"></script>
</html>